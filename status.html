<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>{{ data['title'] }} Status display</title>
  <meta name="description" 
          content="Status display generated by BORA.">
  <link rel="stylesheet" href="{{ static_url("style.css") }}">
  <link rel="stylesheet" href="{{ static_url("jquery-ui.min.css") }}">
  <!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>

<div id="page_info">[VER {{ data['version'] }}] {{ data['title'] }} data monitoring. Last refreshed</div>
<div id="page_title_cache" style="display:none;">{{ data['title'] }}</div>
<div id="page_version_cache" style="display:none;">{{ data['version'] }}</div>
    
{% if data['style'] %}
{% for key in data['style'] %}

{% if data['style'][key]['type'] == "rest" %}

<div id='{{ key }}' class='varbox' data-url='{{ data['rest'][key]['source'] }}' style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]["div"]['width'] }};
    height:{{ data['style'][key]['height'] }}px;' data-type='rest'><p><span style='color: #000; font-size: {{ data['style'][key]['div']['font-size'] }}; font-weight: {{ data['style'][key]['div']['font-weight'] }};' class='title'>{{ data['style'][key]['div']['text-name'] }}</span> <input type='text' style='font-size:{{ data['style'][key]['input']['font-size'] }}; width:{{ data['style'][key]['input']['width'] }}'></div>

{% else %}
{% end %}

{% if data['style'][key]['type'] == "rtsp" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;' data-type='rtsp'><iframe src='{{ data['rtsp'][key] }}' width='{{ data['style'][key]['width'] }}' height='{{ data['style'][key]['height'] }}'></iframe></div>

{% else %}
{% end %}


{% if data['style'][key]['type'] == "calc" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;
    
{% if "background_color" in data['style'][key] %}     
  background-color:{{ data['style'][key]['background_color'] }}'
{% else%}
{% end %}
{% if "condition" in data['style'][key] %}
 data-cond="{{ data['style'][key]['condition'] }}"
{% else%}position
{% end%}
{% if "formula" in data['style'][key] %}
 data-formula="{{ data['style'][key]['formula'] }}"
{% else %}
{% end %}
{% if "lesser" in data['style'][key] %}
 data-lesser="{{ data['style'][key]['lesser'] }}"
{% else %}
{% end %}
{% if "larger" in data['style'][key] %}
 data-larger="{{ data['style'][key]['larger'] }}"
{% else %}
{% end %}
{% if "decimal" in data['style'][key] %}
 data-decimal="{{ data['style'][key]['decimal'] }}"
{% else %}
{% end %}
data-type="{{ data['style'][key]['type'] }}" class='databox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval"> --- </span><span class='unit_title' style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" > {{ data['style'][key]['unit']['title'] }}</span></p>
</div>
{% else %}
{% end %}
    
{% if data['style'][key]['type'] == "data" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}" 
{% else %}
<div tooltip="{{ key }}" 
{% end %}
class="databox" style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px; 

{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}

{% if "condition" in data['style'][key] %}
data-cond="{{ data['style'][key]['condition'] }}"
{% else%}
{% end%}
{% if "formula" in data['style'][key] %}
data-formula="{{ data['style'][key]['formula'] }}"
{% else %}
{% end %}
{% if "lesser" in data['style'][key] %}
data-lesser="{{ data['style'][key]['lesser'] }}"
{% else %}
{% end %}
{% if "larger" in data['style'][key] %}
data-larger="{{ data['style'][key]['larger'] }}"
{% else %}
{% end %}
{% if "decimal" in data['style'][key] %}
data-decimal="{{ data['style'][key]['decimal'] }}"
{% else %}
{% end %}
{% if "exponential" in data['style'][key] %}
data-exponential="{{ data['style'][key]['exponential'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
{% if data['style'][key]['ref'] in data['adei'] %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% else %}
{% end %}
{% else %}
{% end %}

data-adei="{{ data['server'] }}"

{% if data['style'][key]['ref'] in data['adei'] %}
data-query="{{ data['adei'][data['style'][key]['ref']] }}"
{% else %}
{% end %}

{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval"> --- </span><span class='unit_title' style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};"> {{ data['style'][key]['unit']['title'] }}</span>
{% if "trend" in data['style'][key] %}
{% if data['style'][key]['trend'] == 'true' %}
</p>
{% else %}
{% end %}
{% else %}
{% end %}
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval"> --- </span><span class='unit_title' style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};"> {{ data['style'][key]['unit']['title'] }}</span>
{% if "trend" in data['style'][key] %}
{% if data['style'][key]['trend'] == 'true' %}
</p>
{% else %}
{% end %}
{% else %}
{% end %}
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['type'] == "icon" %}
{% if data['style'][key]['icon'] == "valve" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if "trend" in data['style'][key] %}
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
{% else %}
{% end %}

<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("valve_inactive.png") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("valve_inactive.png") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "commbit" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("commbit_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("commbit_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "alarm" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("alarm_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("alarm_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "TMP" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("TMP_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("TMP_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "relay" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("relay_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("relay_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "switch" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("switch_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("switch_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}

{% if data['style'][key]['icon'] == "bottle" %}
{% if "ref" in data['style'][key] %}
<div tooltip="{{ data['style'][key]['ref'] }}"
{% else %}
<div tooltip="{{ key }}"
{% end %}
style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
{% end%}
{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% if "ref" in data['style'][key] %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("bottle_inactive.svg") }}'></img>
</div>
</div>
{% else %}
data-type="{{ data['style'][key]['type'] }}" data-icon="{{ data['style'][key]['icon'] }}" data-off="{{ data['style'][key]['off'] }}" data-offexpression="{{ data['style'][key]['off_condition'] }}" data-on="{{ data['style'][key]['on'] }}" data-onexpression="{{ data['style'][key]['on_condition'] }}" class='databox' id="{{ key }}">
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
<div class="icon">
<img width="{{ data['style'][key]['width'] }}px" height="{{ data['style'][key]['height'] }}px" style='transform: {{ data['style'][key]['rotate'] }}' src='{{ static_url("bottle_inactive.svg") }}'></img>
</div>
</div>
{% end %}

{% else %}
{% end %}
{% else %}
{% end %}

{% if data['style'][key]['type'] == "integer-to-string" %}
<div tooltip="{{ key }}" style='position: absolute; top: {{
    data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }};
    width:{{ data['style'][key]['width'] }}px; height:{{
    data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else%}
'
{% end%}

{% if "cond" in data['style'][key] %}
data-cond="{{ data['style'][key]['cond'] }}"
{% else %}
{% end %}

{% if "trend" in data['style'][key] %}
data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}

data-adei="{{ data['server'] }}"
{% if data['style'][key]['ref'] in data['adei'] %}
data-query="{{ data['adei'][data['style'][key]['ref']] }}"
{% else %}
{% end %}

{% if "linkhtml" in data['style'][key] %}
{% if data['style'][key]['linkhtml'] == 'true' %}
{% if "server" in data %}
onclick="window.open( '{{ data["server"] }}#module=graph&{{ data['adei'][data['style'][key]['ref']] }}&experiment=-&window=86400&module=graph&virtual=srctree&srctree=&infomod=legend', '_blank');"
{% else %}
{% end %}
{% else %}
{% end %}
{% else %}
{% end %}
 data-dict="{{ data['style'][key]['dict'] }}" data-type="{{ data['style'][key]['type'] }}" class='databox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><br /><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval">--- </span>
{% if "trend" in data['style'][key] %}
{% if data['style'][key]['trend'] == 'true' %}
{% else %}
{% end %}
{% else %}
{% end %}
</p>
</div>
{% else %}
{% end %}

{% if data['style'][key]['type'] == "header" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
  background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "titlelink" in data['style'][key] %}
 onclick="window.open( '{{ data['style'][key]['titlelink'] }}' );" 
{% else %}
{% end %}
data-type="{{
    data['style'][key]['type'] }}" class='databox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span></p>
</div>
{% else %}
{% end %}


{% end %}
{% else %}
{% end %}

<img src="{{ static_url( 'background.png' ) }}"></img>

<!-- java script -->
<script src="{{ static_url("jquery-1.12.3.min.js") }}"></script>
<script src="{{ static_url("jquery-ui.min.js") }}"></script>
<script src="{{ static_url("math.min.js") }}"></script>
<script>

jQuery(window).load(function () {

var win_width = $(document).width();
var win_height = $(document).height();
    
    
$("input").on('keypress',function(e) {
    if(e.which == 13) {
        console.log($(this).closest('div').attr('id'));
        console.log($(this).closest('div').attr('data-url'));
        console.log($(this).val());
        var id = $(this).closest('div').attr('id');
        var url = $(this).closest('div').attr('data-url');
        var value = $(this).val();
        rest_set_query(id, url, value);
    }
});

    
$(".databox").hover(function(){
    var trend_time_end = Math.floor(Date.now() / 1000);
    var trend_time_start = trend_time_end - 3600;
    var key = $(this).attr('id');
    var data_adei = $("#" + key).attr('data-adei');
    var data_query = $("#" + key).attr('data-query');
    if ($("#" + key).attr('data-trend') == "true") {
        $('#'+ key).append('<span class="popup" style="top:0; left:250px;"><img src="' + data_adei + '/services/getimage.php?' + data_query + '&window='+ trend_time_start.toString() +'-'+ trend_time_end.toString() + '&frame_width=600&frame_height=400" width="600px" height="400px"/></span>');
        var key_left = parseInt($("#" + key).css("left"));
        var pos_left = key_left + 850;
        var key_top = parseInt($("#" + key).css("top"));
        var pos_top = key_top + 400;
        if(pos_left > win_width) {
            $("#" + key + " .popup").css({
                'right':'250px',
                'left': ''
            });
        }
        if(pos_top > win_height) {
            $("#" + key + " .popup").css({
                'bottom':'0px',
                'top': ''
            });
        }
    }
});



//myTimer();
//var myVar = setInterval(myTimer, 10000);


function myTimer() {
    var dataToSend = {};
    $.ajax({
        url: '/getdata/',
        //url: '/wgts/getabcddata/',
        type: 'GET',
        data: dataToSend,
        success: function (response) {
            //var objresponse = JSON.parse(response);
            console.log(response);
            for (var key in response) {
                //console.log(key, response[key]); 
                data_type = $("#" + key).attr('data-type');
                if($("#" + key).length > 0) {
                    if (data_type == "data") {
                        //console.log("data");
                        var datavalue, set_color, formula;
                        var formula_attr = $("#" + key).attr('data-formula');
                        var delta = (new Date().getTime()/1000.0) - response[key]["timestamp"];
                        var dateTime = new Date( response[key]["timestamp"]*1000.0 );
                        $("#"+key).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
			if (response[key]["value"]) {
                            if (formula_attr) {
                                datavalue = parseFloat(response[key]["value"]).toFixed($("#" + key).attr('data-decimal'));
 			        formula = formula_attr.replace("x", datavalue.toString());
                                datavalue = math.round(math.eval(formula),2);
                                datavalue = datavalue.toFixed($("#" + key).attr('data-decimal'));
		    	    } else {
                                if ( ($("#" + key).attr('data-exponential')) == "True" || ($("#" + key).attr('data-exponential')) == "true" ) {
                                    datavalue = parseFloat(response[key]["value"]);
                                    datavalue = datavalue.toExponential(2)
                                } else {
                                    datavalue = parseFloat(response[key]["value"]).toFixed($("#" + key).attr('data-decimal'));
                                }
                            }
 		    	    set_color = "green";
		        } else {
			    datavalue = "---";
			    set_color = "black";
		        }
                        $(".varval", "#" + key).text(datavalue);
                        var condition_attr = $("#" + key).attr('data-cond');
                        var lesser_attr = $("#" + key).attr('data-lesser');
                        var larger_attr = $("#" + key).attr('data-larger');
  		    	//console.log(condition_attr);
                        if (condition_attr) {
 			    if (response[key]["value"] == condition_attr) {
 			        set_color = "red";
      			    }
		    	}
 		    	if (lesser_attr) {
 			    if (parseFloat(response[key]["value"]) < parseFloat(lesser_attr)) {
 			    	set_color = "red";
      			    }
		    	}
  		        if (larger_attr) {
 			    if (parseFloat(response[key]["value"]) > parseFloat(larger_attr)) {
 			    	set_color = "red";
      			    }
		    	}
		    	$(".varval", "#" + key).css("color", set_color);
		    	$(".unit_title", "#" + key).css("color", set_color);
                    
		    } else if (data_type == "icon") {
                        //console.log("ventil");
                        var delta = (new Date().getTime()/1000.0) - response[key]["timestamp"];
                        var dateTime = new Date( response[key]["timestamp"]*1000.0 );
                        $("#"+key).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
                        var on_attr = $("#" + key).attr('data-on');
                        var off_attr = $("#" + key).attr('data-off');
			var on_condition = $("#" + key).attr('data-onexpression');
			var off_condition = $("#" + key).attr('data-offexpression');
                        if (on_condition == 'onequal'){
		            if (parseFloat(response[key]["value"]) == parseFloat(on_attr)) {
                                $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
                            }
                        } else if (on_condition == 'onsmaller'){	 
 			    if (parseFloat(response[key]["value"]) < parseFloat(on_attr)) {
 			        $(".icon img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
                            }
      			} else if (on_condition == 'ongreater'){
 			    if (parseFloat(response[key]["value"]) > parseFloat(on_attr)) {
 			        $(".icon img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
      			    }
                        }
                        if (off_condition == 'offequal'){
                            if (parseFloat(response[key]["value"]) == parseFloat(off_attr)) {
                                $(".icon img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                            }
                        } else if (off_condition == 'offsmaller'){
                            if (parseFloat(response[key]["value"]) < parseFloat(off_attr)) {
                                $(".icon img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                            }
                        } else if (off_condition == 'offgreater'){
                            if (parseFloat(response[key]["value"]) > parseFloat(off_attr)) {
                                $(".icon img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                            }
                        }
		    } else if (data_type == "integer-to-string") {
                        //console.log("integer-to-string");
                        var delta = (new Date().getTime()/1000.0) - response[key]["timestamp"];
                        var dateTime = new Date( response[key]["timestamp"]*1000.0 );
                        $("#"+key).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
                        var dict_attr = JSON.parse($("#" + key).attr('data-dict'));
                        var dict_cond;
                        if ($("#"+key).attr("data-cond")) {
                            dict_cond = JSON.parse($("#" + key).attr('data-cond'));
                        } else {
                            dict_cond = {};
                        }
                        var dict_color = "";
                        if (key in response) {
                            var token = response[key]["value"];
                            if (token in dict_cond) {
                                dict_color = dict_cond[token];
                            }
                        }
                        $(".varval", "#" + key).css("color", dict_color);
                        $(".varval", "#" + key).text(dict_attr[response[key]["value"]]);
		    }
		}
            }
            $('[id^=virtual_]').each(function( index ) {
                var key = this.id;
		var ref = key.split("_");
                ref.shift();
		ref.pop();
		ref = ref.join("_");
		//ref = ref[1];
		console.log("CHECK THIS");
		console.log(ref, key);
                data_type = $("#" + key).attr('data-type');
                if($("#" + key).length > 0) {
                    if (data_type == "data") {
                        //console.log(key);
                        var datavalue, set_color, formula;
                        var formula_attr = $("#" + key).attr('data-formula');
                        var delta = (new Date().getTime()/1000.0) - response[ref]["timestamp"];
                        var dateTime = new Date( response[ref]["timestamp"]*1000.0 );
                        $("#"+ref).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
			            if (response[ref]["value"]) {
                            if (formula_attr) {
                                datavalue = parseFloat(response[ref]["value"]).toFixed($("#" + key).attr('data-decimal'));
 			                    formula = formula_attr.replace("x", datavalue.toString());
                                datavalue = math.round(math.eval(formula),2);
                                datavalue = datavalue.toFixed($("#" + key).attr('data-decimal'));
		    	            } else {
			                    datavalue = parseFloat(response[ref]["value"]).toFixed($("#" + key).attr('data-decimal'));
                            }
 		    	            set_color = "green";
			            } else {
			                datavalue = "---";
			                set_color = "black";
			            }
                        $(".varval", "#" + key).text(datavalue);
                        var condition_attr = $("#" + key).attr('data-cond');
                        var lesser_attr = $("#" + key).attr('data-lesser');
                        var larger_attr = $("#" + key).attr('data-larger');
  		    	        //console.log(condition_attr);
                        if (condition_attr) {
 			                if (response[ref]["value"] == condition_attr) {
 			    	            set_color = "red";
      			            }
		    	        }
 		    	        if (lesser_attr) {
 			                if (parseFloat(response[ref]["value"]) < parseFloat(lesser_attr)) {
 			    	            set_color = "red";
      			            }
		    	        }
  		                if (larger_attr) {
 			                if (parseFloat(response[ref]["value"]) > parseFloat(larger_attr)) {
 			    	            set_color = "red";
      			            }
		    	        }
		    	        $(".varval", "#" + key).css("color", set_color);
		    	        $(".unit_title", "#" + key).css("color", set_color);
                    
		            } else if (data_type == "icon") {
                                var on_attr = $("#" + key).attr('data-on');
                                var off_attr = $("#" + key).attr('data-off');
                                var on_condition = $("#" + key).attr('data-onexpression');
                                var off_condition = $("#" + key).attr('data-offexpression');
                                var delta = (new Date().getTime()/1000.0) - response[ref]["timestamp"];
                                var dateTime = new Date( response[ref]["timestamp"]*1000.0 );
                                $("#"+key).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
                                if (on_condition == 'onequal'){
                                    if (parseFloat(response[ref]["value"]) == parseFloat(on_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
                                    }
                                } else if (on_condition == 'onsmaller'){
                                    if (parseFloat(response[ref]["value"]) < parseFloat(on_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
                                    }
                                } else if (on_condition == 'ongreater'){
                                    if (parseFloat(response[ref]["value"]) > parseFloat(on_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_green.svg");
                                    }
                                }
                                if (off_condition == 'offequal'){
                                    if (parseFloat(response[ref]["value"]) == parseFloat(off_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                                    }
                                } else if (off_condition == 'offsmaller'){
                                    if (parseFloat(response[ref]["value"]) < parseFloat(off_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                                    }
                                } else if (off_condition == 'offgreater'){
                                    if (parseFloat(response[ref]["value"]) > parseFloat(off_attr)) {
                                        $("img", "#" + key).attr("src", "/static/" + $("#" + key).attr('data-icon') + "_red.svg");
                                    }
                                }
		            } else if (data_type == "integer-to-string") {
                        var delta = (new Date().getTime()/1000.0) - response[key]["timestamp"];
                        var dateTime = new Date( response[key]["timestamp"]*1000.0 );
                        $("#"+key).attr('tooltip',  key + "\nDeltaTime: " + parseFloat(delta).toFixed(3) + " s (" + parseFloat(delta / 60.0).toFixed(3) + " min)");
                        var dict_attr = JSON.parse($("#" + key).attr('data-dict'));
                        var dict_cond;
                        if ($("#"+key).attr("data-cond")) {
                            dict_cond = JSON.parse($("#" + key).attr('data-cond'));
                        } else {
                            dict_cond = {};
                        }
                        var dict_color = "";
                        if (ref in response) {
                            var token = response[ref]["value"];
                            if (token in dict_cond) {
                                dict_color = dict_cond[token];
                            }
                        }
                        $(".varval", "#" + key).css("color", dict_color);
                        $(".varval", "#" + key).text(dict_attr[response[ref]["value"]]);
		            }
		        }
            });
            
            $('[id^=calc_]').each(function( index ) {
                //console.log(this.id);
                //console.log($(this).attr('data-formula'));
                if (typeof $(this).attr('data-formula') != "undefined") {
                var myformula = $(this).attr('data-formula').trim();
                /*
                myformula = myformula.replace(/\[.*?\]/g, '__');
                console.log(myformula);
                */
                var data = myformula;
                var re= /\[(.*?)\]/g;
                var buffer = []
                for(m = re.exec(data); m; m = re.exec(data)){
                    buffer.push(m[1]);
                }
                //console.log("Debug:");
                //console.log(buffer);
                var finalstring = "";
                var pattern = /\[(.*?)\]/g;
                var teststring = myformula.split(/[\[\]]+/);
                //console.log(teststring);
                //console.log(finalstring);
                for (var i = 0; i < teststring.length; i++) {
                    var val = "";
                    
                    if (teststring[i] in response) {
                        val = response[teststring[i]]["value"];
                    } else {
                        val = teststring[i];
                    }
                    finalstring += val;
                    finalstring += " ";
                }
                finalstring = finalstring.trim();
                //console.log(finalstring);
                var myvalue = math.round(math.eval(finalstring),2);
                myvalue = myvalue.toFixed($("#" + this.id).attr('data-decimal'));
 		    	set_color = "green";
                console.log(myvalue);
                $(".varval", "#" + this.id).text(myvalue);
                var condition_attr = $("#" + this.id).attr('data-cond');
                var lesser_attr = $("#" + this.id).attr('data-lesser');
                var larger_attr = $("#" + this.id).attr('data-larger');
  		        //console.log(condition_attr);
                if (condition_attr) {
 			        if (myvalue == condition_attr) {
 			            set_color = "red";
      		        }
		        }
 		    	if (lesser_attr) {
 			        if (parseFloat(myvalue) < parseFloat(lesser_attr)) {
 			            set_color = "red";
      		        }
		        }
  		        if (larger_attr) {
 			        if (parseFloat(myvalue) > parseFloat(larger_attr)) {
 			            set_color = "red";
      			    }
		        }
		        $(".varval", "#" + this.id).css("color", set_color);
		        $(".unit_title", "#" + this.id).css("color", set_color);
                }    
            });
            var page_title_cache = $("#page_title_cache").text();
            var page_version_cache = $("#page_version_cache").text();
	    var datetime = "[VER " + page_version_cache + "] " + page_title_cache + " data monitoring page. Last Sync: " + response["time"];
   	    $("#page_info").text(datetime + " UTC");
            console.log(datetime);

        },
        error: function () {
            console.log("Error.")
        }
    });
}
});


function rest_set_query(id, url, value) {
    
    var myurl = url + "?v=" + value;
    
    $.ajax({
        url: myurl,
        type: 'GET',
        crossDomain: true,
        success: function (response) {
            console.log(response);
        },
        error: function () {
            console.log("Error.")
        }
    });
}
</script>
</body>
</html>
