<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Designer</title>
  <meta name="description" 
          content="Designer Drawing Block.">
  <link rel="stylesheet" href="{{ static_url("style.css") }}">
  <link rel="stylesheet" href="{{ static_url("jquery-ui.min.css") }}">
  <!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
<div id="page_designer_info">[VER {{ data['version'] }}] {{ data['title'] }}. Designer Block.     </div>
<div id="page_title_cache" style="display:none;">{{ data['title'] }}</div>
<div id="page_version_cache" style="display:none;">{{ data['version'] }}</div>

<img src="{{ static_url( 'background.png' ) }}"></img>

<button class="button hide-control" onclick="hidecontrol()">Control Panel</button>
<button id="toggle-panel" class="button showhide" onclick="showhide()">ADEI</button>

{% if data['style'] %}
{% for key in data['style'] %}


{% if data['style'][key]['type'] == "rest" %}

<div id='{{ key }}' class='varbox' style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;' data-type='rest'><p><span style='margin-right: 20px;color: #000; font-size: {{ data['style'][key]['header']['size'] }}; font-weight: {{ data['style'][key]['header']['weight'] }};' class='title'>{{ data['style'][key]['header']['title'] }}</span> <input type='text' style='font-size:{{ data['style'][key]['input']['size'] }};'></div>

{% else %}
{% end %}


{% if data['style'][key]['type'] == "rtsp" %}
<div id='{{ key }}' class='varbox' style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;' data-type='rtsp'>{{ key }}</div>
{% else %}
{% end %}

    
{% if data['style'][key]['type'] == "calc" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;

    {% if "background_color" in data['style'][key] %}
        background-color:{{ data['style'][key]['background_color'] }};' 
    {% else %}
    {% end %}

    {% if "condition" in data['style'][key] %}
        data-cond="{{ data['style'][key]['condition'] }}"
    {% else%}position
    {% end%}

    {% if "formula" in data['style'][key] %}
        data-formula="{{ data['style'][key]['formula'] }}"
    {% else %}
    {% end %}

    {% if "lesser" in data['style'][key] %}
        data-lesser="{{ data['style'][key]['lesser'] }}"
    {% else %}
    {% end %}

    {% if "larger" in data['style'][key] %}
        data-larger="{{ data['style'][key]['larger'] }}"
    {% else %}
    {% end %}

    {% if "decimal" in data['style'][key] %}
        data-decimal="{{ data['style'][key]['decimal'] }}"
    {% else %}
    {% end %}

    data-type="{{ data['style'][key]['type'] }}" class='varbox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval"> XXX.XX <span class='unit_title' style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" > {{ data['style'][key]['unit']['title'] }}</span></span></p>
</div>
{% else %}
{% end %}

    
{% if data['style'][key]['type'] == "data" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;
    
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "condition" in data['style'][key] %}
 data-cond="{{ data['style'][key]['condition'] }}"
{% else%}position
{% end%}
{% if "formula" in data['style'][key] %}
 data-formula="{{ data['style'][key]['formula'] }}"
{% else %}
{% end %}
{% if "lesser" in data['style'][key] %}
 data-lesser="{{ data['style'][key]['lesser'] }}"
{% else %}
{% end %}
{% if "larger" in data['style'][key] %}
 data-larger="{{ data['style'][key]['larger'] }}"
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "exponential" in data['style'][key] %}
 data-exponential="{{ data['style'][key]['exponential'] }}"
{% else %}
{% end %}
{% if "decimal" in data['style'][key] %}
 data-decimal="{{ data['style'][key]['decimal'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" class='varbox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval"> XXX.XX <span class='unit_title' style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" > {{ data['style'][key]['unit']['title'] }}</span></span></p>
</div>
{% else %}
{% end %}


{% if data['style'][key]['type'] == "icon" %}
{% if data['style'][key]['icon'] == "valve" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("valve_inactive.png") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "commbit" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("commbit_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "alarm" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("alarm_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "TMP" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px; 
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("TMP_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "relay" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("relay_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "switch" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("switch_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}

{% if data['style'][key]['icon'] == "bottle" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{ data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px; height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
{% if "on_condition" in data['style'][key] %}
 data-onexpression="{{ data['style'][key]['on_condition'] }}"
{% else %}
{% end %}
{% if "off_condition" in data['style'][key] %}
 data-offexpression="{{ data['style'][key]['off_condition'] }}"
{% else %}
{% end %}
{% if "icon" in data['style'][key] %}
 data-icon="{{ data['style'][key]['icon'] }}"
{% else %}
{% end %}
 data-type="{{ data['style'][key]['type'] }}" data-off="{{ data['style'][key]['off'] }}" data-on="{{ data['style'][key]['on'] }}" class='varbox' id="{{ key }}">
<img width='100%' height='100%' style="transform:{{ data['style'][key]['rotate'] }}" src='{{ static_url("bottle_inactive.svg") }}'></img>
</div>
{% else %}
{% end %}
{% else %}
{% end %}


{% if data['style'][key]['type'] == "integer-to-string" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;
    
{% if "background_color" in data['style'][key] %}
background-color:{{ data['style'][key]['background_color'] }};' 
{% else%}
{% end%}
{% if "cond" in data['style'][key] %}
 data-cond="{{ data['style'][key]['cond'] }}"
{% else%}
{% end%}
{% if "linkhtml" in data['style'][key] %}
 data-linkhtml="{{ data['style'][key]['linkhtml'] }}"
{% else %}
{% end %}
{% if "trend" in data['style'][key] %}
 data-trend="{{ data['style'][key]['trend'] }}"
{% else %}
{% end %}
 data-dict="{{ data['style'][key]['dict'] }}" data-type="{{ data['style'][key]['type'] }}" class='varbox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span><br /><span style="color: #000; font-size: {{ data['style'][key]['unit']['size'] }}px; font-weight: {{ data['style'][key]['unit']['weight'] }};" class="varval">??? </span></p>
</div>
{% else %}
{% end %}

{% if data['style'][key]['type'] == "header" %}
<div style='position: absolute; top: {{ data['style'][key]['top'] }}; left:{{
    data['style'][key]['left'] }}; width:{{ data['style'][key]['width'] }}px;
    height:{{ data['style'][key]['height'] }}px;
{% if "background_color" in data['style'][key] %}    
background-color:{{ data['style'][key]['background_color'] }};'
{% else %}
{% end %}
{% if "titlelink" in data['style'][key] %}
data-titlelink="{{ data['style'][key]['titlelink'] }}"
{% else %}
{% end %}
data-type="{{ data['style'][key]['type'] }}" class='varbox' id="{{ key }}">
<p><span style="color: #000; font-size: {{ data['style'][key]['header']['size'] }}px; font-weight: {{ data['style'][key]['header']['weight'] }};" class="title">{{ data['style'][key]['header']['title'] }} </span></p>
</div>
{% else %}
{% end %}


{% end %}

{% else %}
{% end %}

<div id="tool-btn3">
  <span class="info">Variable</span>

<select id="varname3" style="font-size:16pt;">
{% if data['rtsp'] %}
  {% for key in data['rtsp'] %}
    <option value={{ key }}>{{key}}</option>
  {% end %}
{% else %}
{% end %}
</select>

<br /><br />
<span class="info">Width</span>
<input type="text" id="rtsp_width" placeholder="number" style="font-size:16pt; width=100px;"/>
<span class="info">Height</span>
<input type="text" id="rtsp_height" placeholder="number" style="font-size:16pt; width=100px;"/>
<br /><br />
<button class="button save" onclick="backup()">Backup</button>
<button style="display:none;" id="buttonHighlight" class="button highlight" onclick="highlight({{ data['cache'] }})">Highlight</button>
<button class="button add" onclick="add_rtsp()">Add</button>
<button class="button remove" onclick="myremove()">Remove</button>
<button class="button save" onclick="mysave({{ data['cache'] }})">Save</button>
</div>

<div id="tool-btn2">
  <span class="info">Variable</span>

<select id="varname2" style="font-size:16pt;">
    {% if data['rest'] %}
      {% for key in data['rest'] %}
        <option value={{ key }}>{{key}}</option>
      {% end %}
    {% else %}
    {% end %}
</select>
<br /><br />
<span class="info">Title</span>:

<input type="text" id="elem_title_text_rest" placeholder="text" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_title_size_rest" placeholder="size" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_input_size_rest" placeholder="input size" style="font-size:16pt; width=100px;"/>

<select id="elem_title_style_rest" style="font-size:16pt;">
  <option value="400">normal</option>
  <option value="700">bold</option>
</select>
<br /><br />

<button class="button save" onclick="backup()">Backup</button>
<button style="display:none;" id="buttonHighlight" class="button highlight" onclick="highlight({{ data['cache'] }})">Highlight</button>
<button class="button add" onclick="add_rest()">Add</button>
<button class="button remove" onclick="myremove()">Remove</button>
<button class="button save" onclick="mysave({{ data['cache'] }})">Save</button>
<span class="info"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Background colour</span>
<input type="text" id="background_color_rest" placeholder="hex code" style="font-size:16pt; width=100px;"/>
</div>
    
    
<div id="tool-btn">
<span class="info">Variable</span>
<select id="varname" style="font-size:16pt;">
{% if data['index'] %}  
  {% for key in data['index'] %}
    {% if key != "time" %}
    
    {% if key in data['style'] %}
        {% if 'type' in data['style'][key] %}
        
            {% if data['style'][key]['type'] != "rtsp" %}
              {% if data['style'][key]['type'] != "rest" %}
              <option value={{ key }}>{{key}}</option>
              {% else %}
              {% end %}
            {% else %}
            {% end %}
        {% else %}
        {% end %}
    {% else %}
    <option value={{ key }}>{{key}}</option>
    {% end %}
        
    {% else %}
    {% end %}
  {% end %}
{% else %}
{% end %}
</select>
<span class="info">Type</span>
<select id="vartype" onchange="inputEnable()" style="font-size:16pt;">
  <option value="data">data</option>
  <option value="icon">icon</option>
  <option value="integer-to-string">integer-to-string</option>
  <option value="header">header</option>
  <option value="calc">calc</option>
</select>
<span class="info">Icon</span>
<select id="icon" style="font-size:16pt;" disabled="true">
  <option disabled selected value></option>
  <option value="valve">valve</option>
  <option value="commbit">commbit</option>
  <option value="alarm">alarm</option>
  <option value="TMP">TMP</option>
  <option value="bottle">bottle</option>
  <option value="relay">relay</option>
  <option value="switch">switch</option>
</select>
<span class="info">Attribute</span>
<select id="varattr" style="font-size:16pt;">
  <option value="normal">Normal</option>
  <option value="virtual">Virtual</option>
</select>
<span class="info">Virtual ID</span>
<input type="text" id="virtual_id_text" placeholder="text" style="font-size:16pt; width=100px;"/>
<br /><br />
<span class="info">Condition: on when x </span>
<select id="onexpression" style="font-size:16pt;" disabled>
  <option value="onsmaller"><</option>
  <option value="onequal">=</option>
  <option value="ongreater">></option>
</select>
<input type="text" id="onvalue" placeholder="number" style="font-size:16pt; width=100px;" disabled/>
<span class="info">&nbsp;&nbsp;&nbsp;&nbsp; off when x </span>
<select id="offexpression" style="font-size:16pt;" disabled>
  <option value="offsmaller"><</option>
  <option value="offequal">=</option>
  <option value="offgreater">></option>
</select>
<input type="text" id="offvalue" placeholder="number" style="font-size:16pt; width=100px;" disabled/>
<span class="info">rotate</span>
<input type="text" id="rotate" placeholder="icon rotation angle in deg" style="font-size:16pt; width=100px;"/>
<br /><br />
<span class="info">Title</span>:

<input type="text" id="elem_title_text" placeholder="text" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_title_size" placeholder="size" style="font-size:16pt; width=100px;"/>

<input type="text" id="elem_lesser_range" placeholder="smaller than (red)" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_larger_range" placeholder="larger than (red)" style="font-size:16pt; width=100px;"/>

<select id="elem_title_style" style="font-size:16pt;">
  <option value="400">normal</option>
  <option value="700">bold</option>
</select>

<input type="text" id="decimal_place" placeholder="decimal place" style="font-size:16pt; width:150px;"/>
<br /><br />
<span class="info">Value</span>
<input type="text" id="elem_unit_text" placeholder="unit" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_unit_size" placeholder="size" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_condition_range" placeholder="condition (red)" style="font-size:16pt; width=100px;"/>
<input type="text" id="elem_formula" placeholder="Equation" style="font-size:16pt; width=100px;"/>
<select id="elem_unit_style" style="font-size:16pt;">
  <option value="400">normal</option>
  <option value="700">bold</option>
</select>
<span class="info">Exp</span><input type="checkbox" id="elem_exponential" style="font-size:16pt; width:20px; height:20px;"/>
<br /><br />
<button class="button save" onclick="backup()">Backup</button>
<button style="display:none;" id="buttonHighlight" class="button highlight" onclick="highlight({{ data['cache'] }})">Highlight</button>
<button class="button add" onclick="add()">Add</button>
<button class="button remove" onclick="myremove()">Remove</button>
<button class="button save" onclick="mysave({{ data['cache'] }})">Save</button>
<span class="info"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Background colour</span>
<input type="text" id="background_color" placeholder="hex code" style="font-size:16pt; width=100px;"/>
<span class="info">Link (adei)</span><input type="checkbox" id="elem_linkhtml" style="font-size:16pt; width:20px; height:20px;"/>
<span class="info">Trend</span><input type="checkbox" id="elem_trend" style="font-size:16pt; width:20px; height:20px;"/>
<input type="text" id="titlelink" placeholder="header link" style="font-size:16pt; width:150px;"/>
</div>


<!-- java script -->
<script src="{{ static_url("jquery-1.12.3.min.js") }}"></script>
<script src="{{ static_url("jquery-ui.min.js") }}"></script>
<script src="{{ static_url("dat.gui.js") }}"></script>

<script>
    
var control_panel = 0;
var varname;

function hidecontrol() {
    if ($("#toggle-panel").is(":visible")) {
        console.log("button visible");
        $("#toggle-panel").hide();
        $("#tool-btn").hide();
        $("#tool-btn2").hide();
        $("#tool-btn3").hide();
    } else {
        console.log("button not visible");
        $("#toggle-panel").show();
        $("#tool-btn").show();
        $("#tool-btn2").show();
        $("#tool-btn3").show();
        control_panel = 0;
        $("#toggle-panel").text("ADEI");
        $("#toggle-panel").css("background-color","black");
    }
}


function inputEnable() {
    if ($("#vartype option:selected").val()=="icon") {
        $("#icon").prop("disabled",false);
        $("#onexpression").prop("disabled",false);
        $("#onvalue").prop("disabled",false);
        $("#offexpression").prop("disabled",false);
        $("#offvalue").prop("disabled",false);
    } else {
        $("#icon").prop("disabled",true);
        $("#onexpression").prop("disabled",true);
        $("#onvalue").prop("disabled",true);
        $("#offexpression").prop("disabled",true);
        $("#offvalue").prop("disabled",true);
    }
}

function backup() {
    $.ajax({
        url: '/backup/',
        type: 'POST',
        success: function (response) {
            alert("Backup success!");
        },
        error: function () {
            console.log("Error.")
        }
    });
}    
    
function showhide() {
    
    if (control_panel == 0) {
        $("#toggle-panel").text("REST");
        $("#tool-btn").hide();
        $("#tool-btn2").show();
        $("#tool-btn3").hide();
        $("#toggle-panel").css("background-color","rgba(38, 42, 86, 1.0)");
        control_panel = 1;
    } else if (control_panel == 1) {
        $("#toggle-panel").text("RTSP");
        $("#tool-btn").hide();
        $("#tool-btn2").hide();
        $("#tool-btn3").show();
        $("#toggle-panel").css("background-color","rgba(184, 98, 27, 1.0)");
        control_panel = 2;
    } else {
        $("#toggle-panel").text("ADEI");
        $("#tool-btn").show();
        $("#tool-btn2").hide();
        $("#tool-btn3").hide();
        $("#toggle-panel").css("background-color","black");
        control_panel = 0;
    }
}
    
function add_rest() {
    var varname2 = $("#varname2 option:selected").text();
        
    if (document.getElementById(varname2)) {
        alert('this record already exists');
        console.log("Existed");
        return;
    }
    console.log(varname2);

    var html_text = "<div id='" + varname2 + "' style='position: absolute;top:200px;left:200px' " +
        "background-color:" + $("#background_color_rest").val() + ";' class='varbox' data-type='rest'>" +
        "<p><span style='margin-right: 20px;color: #000; font-size: " + $("#elem_title_size_rest").val() + "px; font-weight: " + $("#elem_title_style_rest").val() + ";' class='title'>" + $("#elem_title_text_rest").val() + "</span> <input type='text' style='font-size:" + $("#elem_input_size_rest").val() + "px; width= " + $("#elem_input_width_rest").val() + "px;'></p></div>"
    
    console.log( $("#background_color_rest").val());
    console.log( $("#elem_title_text_rest").val());
    console.log( $("#elem_title_size_rest").val());
    console.log( $("#elem_input_size_rest").val());
    console.log( $("#elem_input_width_rest").val());
    console.log( $("#elem_title_style_rest").val());
    
        
    $( "body" ).append(html_text);
    $("#"+varname2).draggable();
    $("#"+varname2).resizable();
        
    $('#'+varname2).click(function() {
        varname = $(this).attr("id");
        $("#varname2").val($(this).attr("id"));
        $("#buttonHighlight").trigger("click");
    });
    
    $("#"+varname2+" > input").keydown(function(e){
        console.log("Input Keydown");
        if(e.which == 13) {
            e.preventDefault();

            console.log("Pressed Enter: " + (this).attr('id'));
            $(this).css("background-color", "yellow");
            /*
            var id = $(this).attr('id');
            var value = $(this).val();

            alert('Enter pressed for '+id+'\n'+
              'Value = '+value;
            )
             */
            
            return false;
        }
        
    });
}
    
function add_rtsp() {
    var varname3 = $("#varname3 option:selected").text();
    
    if (document.getElementById(varname3)) {
      alert('this record already exists');
      console.log("Existed");
      return;
    }

    console.log(varname3);
    console.log($("#rtsp_width").val());
    console.log($("#rtsp_height").val());
    //var html_text = "<div id='varname3' style='position: absolute;top:0;left:200px;' class='varbox box_highlight'><iframe src='http://localhost:1984/stream.html?src=test&mode=webrtc' width='400' height='400'></iframe></div>"
    var html_text = "<div id='" + varname3 + "' style='position: absolute;top:0;left:200px; width:" + ($("#rtsp_width").val()).toString() + "px; height:" + ($("#rtsp_height").val()).toString() + "px' class='varbox' data-type='rtsp'>" + varname3 + "</div>"
    
    //<iframe src='' width='400' height='400'></iframe>
    
    $( "body" ).append(html_text);
    $("#"+varname3).draggable();
    //$("#camera01").resizable();
    
    $('#'+varname3).click(function() {
        varname = $(this).attr("id");
        $("#varname3").val($(this).attr("id"));
        $("#buttonHighlight").trigger("click");
        
    });
}
    
function add() {
    console.log("add element");
    title_text = $("#elem_title_text").val();
    title_text = title_text.trim();
    title_color = "#000000";
    //title_color = $("#elem_title_color").val();
    title_size = $("#elem_title_size").val();
    title_style = $("#elem_title_style option:selected").val();
    
    unit_text = $("#elem_unit_text").val();
    unit_text = unit_text.trim();
    unit_color = "#000";
    //unit_color = $("#elem_unit_color").val();
    unit_size = $("#elem_unit_size").val();
    unit_style = $("#elem_unit_style option:selected").val();
    
    data_condition = $("#elem_condition_range").val();
    //data_max = $("#elem_max_range").val();
    
    data_formula = $("#elem_formula").val();
    
    //console.log(key);
    
    virtual_id = $("#virtual_id_text").val();
    virtual_id = virtual_id.trim();
    if (virtual_id == "") {
        virtual_id = "0";
    }
    
    
    if ($('#elem_exponential').is(":checked")) {
        data_exponential = true;
        //$("#"+key).attr("data-exponential", true);
    } else {
        data_exponential = false;
        //$("#"+key).attr("data-exponential", false);
    }
    if ($('#elem_linkhtml').is(":checked")) {
        data_linkhtml = true;
        //$("#"+key).attr("data-linkhtml", true);
    } else {
        data_linkhtml = false;
        //$("#"+key).attr("data-linkhtml", false);
    }
     
    if ($('#elem_trend').is(":checked")) {
        data_trend = true;
        //$("#"+key).attr("data-trend", true);
    } else {
        data_trend = false;
        //$("#"+key).attr("data-trend", false);
    }
    
 
    data_lesser = $("#elem_lesser_range").val();
    data_larger = $("#elem_larger_range").val();
    decimal_place = $("#decimal_place").val();
    titlelink = $("#titlelink").val();
    background_color = $("#background_color").val(); 
    varval = $( "#varname option:selected").val();
    varname = $("#varname option:selected").text();
    
    vartype = $("#vartype option:selected").val();
    
    icon = $("#icon option:selected").val();
    onexpression = $("#onexpression option:selected").val();
    onvalue = $("#onvalue").val();
    offexpression = $("#offexpression option:selected").val();
    offvalue = $("#offvalue").val();
    varattr = $("#varattr option:selected").val();
    rotate = $("#rotate").val(); 
    console.log("Selected");
    console.log(varattr);
    console.log(virtual_id);
    console.log(vartype);
    console.log(title_text, unit_text, background_color, varname, varval, vartype);
    
        
    if(($("#" + varname).length == 0) || (vartype=="header") || (vartype=="calc") || (varattr=="virtual")) {
        console.log("Must enter here");
        console.log(vartype);
        if (vartype == "data") {
            
            if (varattr=="virtual") {
                virtual_name = "virtual_" + varname + "_" + virtual_id;
                if ( $("#" + virtual_name).length > 0 ) {
                    for (i = 0; i < 50; i++) { 
                        virtual_name = "virtual_" + varname + "_" + i.toString();
                        console.log($("#" + virtual_name).length);
                        if (!$("#" + virtual_name).length){
                            break;
                         }
                    }
                }
                varname = virtual_name;
            }
            console.log("Data");
            html_text = "<div " +
                    "style='position: absolute; " +
                           "top:0; " +
                           "left:0; " +
                           "background-color:" + background_color + "'" +
                    "class='varbox box_highlight' " +
                    "id='" + varname +
                    "' data-type='" + vartype +
                    "' data-cond='" + data_condition +
                    "' data-formula='" + data_formula +
                    "' data-lesser='" + data_lesser + 
 		            "' data-larger='" + data_larger + 
                    "' data-exponential='" + data_exponential +
                    "' data-linkhtml='" + data_linkhtml +
                    "' data-trend='" + data_trend +
                    "' data-decimal='" + decimal_place +
                    "'>" +
                    "<p>" +
                    "<span style='color: " + title_color + ";" + 
                    "font-size:" + title_size + "px; " + 
                    "font-weight: " + title_style + ";' " + 
                    "class='title'>" + title_text +
                    " </span>" + 
                    "<span style='color: " + unit_color + "; " + 
                        "font-size:" + unit_size + "px; " +
                        "font-weight: " + unit_style + ";' " + 
                        "class='varval'>XXX.XX </span>" + 
                    "<span style='color: " + unit_color + "; " + 
                        "font-size:" + unit_size + "px; " +
                        "font-weight: " + unit_style + ";' " + 
                        "class='unit_title'>" + unit_text + "</span></p>" +
        	    "</div>";
        } else if (vartype == "header") {
            console.log("Header");
            if (title_text.length > 0) { 
                var clean_text = title_text.replace(/[^a-zA-Z0-9 ]/g, "")
                varname = "header_" + clean_text.replace(/\s+/g, '-').toLowerCase();
                html_text = "<div " +
                        "style='position: absolute; " +
                               "top:0; " +
                               "left:0; " +
                               "background-color:" + background_color + "'" +
                        "class='varbox box_highlight' " + 
                        "id='" + varname +
                        "' data-type='" + vartype +
                        "' data-cond='" + data_condition +
                        "' data-titlelink='" + titlelink +
                        "' data-lesser='" + data_lesser + 
 		                "' data-larger='" + data_larger + 
                        "'>" +
                        "<p>" +
                        "<span style='color: " + title_color + ";" + 
                        "font-size:" + title_size + "px; " + 
                        "font-weight: " + title_style + ";' " + 
                        "class='title'>" + title_text +
                        " </span></p>" + 
        	        "</div>";
            
                $('#varname').append($('<option>', {
                    value: varname,
                    text: varname
                }));
                $('#varname').val(varname);
                $('#elem_title_text').removeClass('glowing_border');
            } else {
                console.log("NoInput");
                html_text = "";
                $('#elem_title_text').addClass('glowing_border');
            }
        } else if (vartype == "calc") {
            console.log("Calc");
            if (data_formula.length > 0) {
                var clean_text = data_formula.replace(/[^a-zA-Z0-9 ]/g, "")
                varname = "calc_" + clean_text.replace(/\s+/g, '-').toLowerCase();
                console.log(varname);
                html_text = "<div " +
                        "style='position: absolute; " +
                               "top:0; " +
                               "left:0; " +
                               "background-color:" + background_color + "'" +
                        "class='varbox box_highlight' " + 
                        "id='" + varname +
                        "' data-type='" + vartype +
                        "' data-cond='" + data_condition +
                        "' data-lesser='" + data_lesser + 
 		                "' data-larger='" + data_larger +
                        "' data-formula='" + data_formula +
                        "' data-decimal='" + decimal_place +
                        "'>" +
                        "<p>" +
                        "<span style='color: " + title_color + ";" + 
                        "font-size:" + title_size + "px; " + 
                        "font-weight: " + title_style + ";' " + 
                        "class='title'>" + title_text +
                        " </span>" + 
                        "<span style='color: " + unit_color + "; " + 
                               "font-size:" + unit_size + "px; " +
                               "font-weight: " + unit_style + ";' " + 
                        "class='varval'>XXX.XX </span>" + 
                        "<span style='color: " + unit_color + "; " + 
                            "font-size:" + unit_size + "px; " +
                            "font-weight: " + unit_style + ";' " + 
                            "class='unit_title'>" + unit_text + "</span></p>" +
        	        "</div>";
            
                $('#varname').append($('<option>', {
                    value: varname,
                    text: varname
                }));
                $('#varname').val(varname);
                $('#elem_formula').removeClass('glowing_border');
            } else {
                console.log("NoInput");
                html_text = "";
                $('#elem_formula').addClass('glowing_border');
            }
            
        } else if (vartype == "icon") {
                if (varattr=="virtual") {
                    virtual_name = "virtual_" + varname + "_" + virtual_id;
                    if ( $("#" + virtual_name).length > 0 ) {
                        for (i = 0; i < 50; i++) {
                            virtual_name = "virtual_" + varname + "_" + i.toString();
                            console.log($("#" + virtual_name).length);
                            if (!$("#" + virtual_name).length){
                                break;
                            }
                        }
                    }
                    varname = virtual_name;
                }
                console.log(icon);
                if ((onvalue.length > 0)&&(offvalue.length > 0)) {
                    //var token = JSON.parse(unit_text);
                    //data_on = token["on"];
                    //data_off = token["off"];
                    html_text = "<div " +
                        "style='position: absolute; " +
                               "top:0; " +
                               "left:0; " +
                               "background-color:" + background_color + "'" +
                        "class='varbox box_highlight' " +
                        "id='" + varname +
                        "' data-type='" + vartype +
                        "' data-cond='" + data_condition +
                        "' data-icon='" + icon +
                        "' data-lesser='" + data_lesser +
                                "' data-larger='" + data_larger +
                                "' data-onexpression='" + onexpression +
                                "' data-on='" + onvalue +
                                "' data-offexpression='" + offexpression +
                                "' data-off='" + offvalue +
                        "' data-linkhtml='" + data_linkhtml +
                        "' data-trend='" + data_trend +
                        "'>" +
                        "<img width='100%' height='100%' " +
                            "style='transform:rotate(" + rotate + ")'" +
                            "src='/static/" + icon + "_inactive.svg' ></img>" +
                        "</div>";
                     $('#onvalue').removeClass('glowing_border');
                     $('#offvalue').removeClass('glowing_border');
                 } else{
                     console.log("NoInput");
                     html_text = "";
                     $('#onvalue').addClass('glowing_border');
                     $('#offvalue').addClass('glowing_border');
                 }
         
	} else if (vartype == "integer-to-string") {
            if (varattr=="virtual") {
                virtual_name = "virtual_" + varname + "_" + virtual_id;
                if ( $("#" + virtual_name).length > 0 ) {
                    for (i = 0; i < 50; i++) {
                        virtual_name = "virtual_" + varname + "_" + i.toString();
                        console.log($("#" + virtual_name).length);
                        if (!$("#" + virtual_name).length){
                            break;
                        }
                    }
                }
                varname = virtual_name;
            }
            console.log("Integer2String");
            
            if (unit_text.length > 0) {
                html_text = "<div " +
                        "style='position: absolute; " +
                               "top:0; " +
                               "left:0; " +
                               "background-color:" + background_color + "'" +
                        "class='varbox box_highlight' " + 
                        "id='" + varname +
                        "' data-type='" + vartype +
                        "' data-dict='" + unit_text +
                        "' data-cond='" + data_condition +
                        "' data-linkhtml='" + data_linkhtml +
                        "' data-trend='" + data_trend +
                        "'>" +
                        "<p>" +
                        "<span style='color: " + title_color + ";" + 
                        "font-size:" + title_size + "px; " + 
                        "font-weight: " + title_style + ";' " + 
                        "class='title'>" + title_text +
                        " </span><br />" + 
                        "<span style='color: " + unit_color + "; " + 
                               "font-size:" + unit_size + "px; " +
                               "font-weight: " + unit_style + ";' " + 
                        "class='varval'>??? o/soan>" + 
                        "</p>" +
        	            "</div>";
                $('#elem_unit_text').removeClass('glowing_border');
            } else {
                console.log("NoInput");
                html_text = "";
                $('#elem_unit_text').addClass('glowing_border');
            }
        }
        
        console.log("Adding element");
        console.log(html_text);
        if (html_text.length > 0) {
            $( "body" ).append(html_text);
            $("#"+varname).draggable();
            $("#"+varname).resizable();
        }
    }
}


    
function myremove() {
    var varname;
    if (control_panel == 2) {
        varname = $("#varname3 option:selected").text();
    } else if (control_panel == 1) {
        varname = $("#varname2 option:selected").text();
    } else {
        varname = $("#varname option:selected").text();
    }
    console.log(varname);
    if($("#" + varname).length > 0) {
        $("#"+varname).remove();
        console.log(varname +" removed.");
        //onexpression = $("#onexpression option:selected").val();
        //onvalue = $("#onvalue").val();
    }
}
    
    
    
function mysave(data) {
    console.log("saving...");
    varname = $("#varname option:selected").text();
    varattr = $("#varattr option:selected").val();
    
    console.log("debug");
    console.log(varattr);
    var position = {};
    for(key in data) {
        var tmp = {};
        //console.log(key);
        if($("#" + key).length > 0 ) {
            tmp["ref"] = key;
            tmp["left"] = $("#"+key).css("left");
            tmp["top"] = $("#"+key).css("top");
            tmp["width"] = $("#"+key).width();
            tmp["height"] = $("#"+key).height();
            tmp["type"] = $("#"+key).attr("data-type");
            if ( $("#"+key).attr("data-type") == "data" ) {
                if ( (varname == key) && (varattr == "normal") ) {
                    tmp["condition"] = $("#elem_condtion_range").val();
            	    tmp["formula"] = $("#elem_formula").val();
             	    tmp["lesser"] = $("#elem_lesser_range").val();
            	    tmp["larger"] = $("#elem_larger_range").val();
		    tmp["decimal"] = $("#decimal_place").val();
                    if ($('#elem_exponential').is(":checked")) {
                        tmp["exponential"] = "true";
			$("#"+key).attr("data-exponential", "true");
                    } else {
                        tmp["exponential"] = "false";
			$("#"+key).attr("data-exponential", "false");
                    }
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
			$("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
			$("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    }
            	    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    } 
                    //console.log($("#"+key).css("background-color"));
                    header = {};
            	    header["title"] = $("#elem_title_text").val().trim();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = $("#elem_title_size").val();
            	    header["weight"] = $("#elem_title_style").val();
         
                    // update field
                    $(".title", "#"+key).text(header["title"]);
                    $(".title", "#"+key).css("font-size", header["size"] + "px");
                    $(".title", "#"+key).css("font-weight", header["weight"]);

            	    unit = {};
            	    unit["title"] = $("#elem_unit_text").val().trim();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $("#elem_unit_size").val();
            	    unit["weight"] = $("#elem_unit_style").val();
                    $(".varval", "#"+key).css("font-size", unit["size"] + "px");
                    $(".unit_title", "#"+key).css("font-size", unit["size"] + "px");
                    $(".unit_title", "#"+key).css("font-weight", unit["weight"]);                    
                    $(".varval", "#"+key).css("font-weight", unit["weight"]);

                } else {
            	    tmp["condition"] = $("#"+key).attr("data-cond");
            	    tmp["formula"] = $("#"+key).attr("data-formula");
             	    tmp["lesser"] = $("#"+key).attr("data-lesser");
            	    tmp["larger"] = $("#"+key).attr("data-larger");
                    tmp["exponential"] = $("#"+key).attr("data-exponential");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
		    tmp["decimal"] = $("#"+key).attr("data-decimal") || 2;
             	    //tmp["min"] = $("#"+key).attr("min");
           	    //tmp["max"] = $("#"+key).attr("max");
                    header = {};
            	    header["title"] = $(".title", "#"+key).text();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = parseInt($(".title", "#"+key).css("font-size")) || 28;
                    tmp["background_color"] = $("#"+key).css("background-color");

                    var fontWeight = $(".title", "#"+key).css("font-weight");
                    if (fontWeight == 'bold' || fontWeight == '700') {
            	        header["weight"] = "700";
                    } else {
            	        header["weight"] = "400";
                    }
                    
            
            	    unit = {};
            	    unit["title"] = $(".unit_title", "#"+key).text();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = parseInt($(".varval", "#"+key).css("font-size")) || 28;
                    
                    fontWeight = $(".varval", "#"+key).css("font-weight");
                    if (fontWeight == 'bold' || fontWeight == '700') {
            	        unit["weight"] = "700";
                    } else {
            	        unit["weight"] = "400";
                    }
                }
            	tmp["header"] = header;
            	tmp["unit"] = unit;
            //} else if ( $("#"+key).attr("data-type") == "header" ) {
	    //	header = {};
	    //	header["title"] = $(".title", "#"+key).text();
	    //	header["size"] = $(".title", "#"+key).css("font-size");
	    //	header["weight"] = $(".title", "#"+key).css("font-weight");
            //	tmp["header"] = header;
           } else if ( $("#"+key).attr("data-type") == "icon" ) {
                if ((varname == key) && (varattr == "normal")) {
                    //var unit_text = $("#elem_unit_text").val();
                    //unit_text = unit_text.trim();
                    //var dtoken = JSON.parse(unit_text);
                    tmp["on"] = $("#onvalue").val();
                    tmp["on_condition"] = $("#onexpression").val();
                    tmp["off"] = $("#offvalue").val();
                    tmp["off_condition"] = $("#offexpression").val();
                    tmp["icon"] = $("#"+key).attr("data-icon");
		    tmp["rotate"] = "rotate(" + $("#rotate").val() + "deg)";
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    }
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    }
                } else {
                    tmp["icon"] = $("#"+key).attr("data-icon");
                    tmp["on"] = $("#"+key).attr("data-on");
                    tmp["on_condition"] = $("#"+key).attr("data-onexpression");
                    tmp["off"] = $("#"+key).attr("data-off");
                    tmp["off_condition"] = $("#"+key).attr("data-offexpression");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
                    tmp["rotate"] = $("#"+key).children().css("transform");
                    tmp["background_color"] = $("#"+key).css("background-color");
                }
            } else if ( $("#"+key).attr("data-type") == "integer-to-string" ) {
                if ((varname == key)&& (varattr == "normal")) {
                    var unit_text = $("#elem_unit_text").val();
                    unit_text = unit_text.trim();
                    var data_condition = $("#elem_condition_range").val();
            	    tmp["cond"] = data_condition;
            	    tmp["dict"] = unit_text;
             	    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    } 
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    }
            	    header = {};
            	    header["title"] = $("#elem_title_text").val().trim();
            	    header["size"] = $("#elem_title_size").val();
            	    header["weight"] = $("#elem_title_style").val();
            
            	    unit = {};
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $("#elem_unit_size").val();
            	    unit["weight"] = $("#elem_unit_style option:selected").val();
                } else {
            	    tmp["dict"] = $("#"+key).attr("data-dict");
            	    tmp["cond"] = $("#"+key).attr("data-cond");
            	    tmp["background_color"] = $("#"+key).css("background-color");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
                    header = {};
            	    header["title"] = $(".title", "#"+key).text();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = $(".title", "#"+key).css("font-size");
            	    header["weight"] = $(".title", "#"+key).css("font-weight");
            
            	    unit = {};
            	    //unit["title"] = $(".unit_title", "#"+key).text();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $(".varval", "#"+key).css("font-size");
            	    unit["weight"] = $(".varval", "#"+key).css("font-weight");
                }
            	tmp["header"] = header;
            	tmp["unit"] = unit;
            }
            position[key] = tmp;
        }
    }
    
    var title_text = $("#elem_title_text").val();
    title_text = title_text.trim();
    
    var clean_text = title_text.replace(/[^a-zA-Z0-9 ]/g, "")
    var token = "header_" + clean_text.replace(/\s+/g, '-').toLowerCase();
    $('[id^=virtual_]').each(function( index ) {
        var tmp = {};
        var key = this.id;
        var ref = key.split("_");
        ref.shift();
        ref.pop();
        ref = ref.join("_");
        //ref = ref[1];
        if (key != "virtual_id_text") {
            
        console.log("Check this");
        console.log(key);
        if($("#" + key).length > 0 ) {
            tmp["ref"] = ref;
            tmp["left"] = $("#"+key).css("left");
            tmp["top"] = $("#"+key).css("top");
            tmp["width"] = $("#"+key).width();
            tmp["height"] = $("#"+key).height();
            tmp["type"] = $("#"+key).attr("data-type");
            
            if ( $("#"+key).attr("data-type") == "data" ) {
                if (varname == key) {
            	    tmp["condition"] = $("#elem_condtion_range").val();
            	    tmp["formula"] = $("#elem_formula").val();
             	    tmp["lesser"] = $("#elem_lesser_range").val();
            	    tmp["larger"] = $("#elem_larger_range").val();
                    tmp["decimal"] = $("#decimal_place").val();
            
            	    header = {};
            	    header["title"] = $("#elem_title_text").val().trim();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = $("#elem_title_size").val();
            	    header["weight"] = $("#elem_title_style option:selected").val();
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    }
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    } 
                    // update field
                    $(".title", "#"+key).css("font-size", header["size"] + "px");
                    $(".title", "#"+key).css("font-weight", header["weight"] + "px");
            
            	    unit = {};
            	    unit["title"] = $("#elem_unit_text").val().trim();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $("#elem_unit_size").val();
            	    unit["weight"] = $("#elem_unit_style option:selected").val();
                    
                    // update field
                    $(".varval", "#"+key).css("font-size", unit["size"] + "px");
                    $(".unit_title", "#"+key).css("font-size", unit["size"] + "px");
                    $(".varval", "#"+key).css("font-weight", unit["weight"] + "px");
                    
                } else {
            	    tmp["condition"] = $("#"+key).attr("data-cond");
            	    tmp["formula"] = $("#"+key).attr("data-formula");
             	    tmp["lesser"] = $("#"+key).attr("data-lesser");
            	    tmp["larger"] = $("#"+key).attr("data-larger");
                    tmp["decimal"] = $("#"+key).attr("data-decimal") || 2;
             	    //tmp["min"] = $("#"+key).attr("min");
                    //tmp["max"] = $("#"+key).attr("max");
                    tmp["background_color"] = $("#"+key).css("background-color");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
            	    header = {};
            	    header["title"] = $(".title", "#"+key).text();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = parseInt($(".title", "#"+key).css("font-size")) || 28;
            	    header["weight"] = parseInt($(".title", "#"+key).css("font-weight")) || 28;
            
            	    unit = {};
            	    unit["title"] = $(".unit_title", "#"+key).text();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = parseInt($(".varval", "#"+key).css("font-size")) || 28;
            	    unit["weight"] = parseInt($(".varval", "#"+key).css("font-weight")) || 28;
                }
            	tmp["header"] = header;
            	tmp["unit"] = unit;
            //} else if ( $("#"+key).attr("data-type") == "header" ) {
	    //	        header = {};
	    //	        header["title"] = $(".title", "#"+key).text();
	    //	        header["size"] = $(".title", "#"+key).css("font-size");
	    //	        header["weight"] = $(".title", "#"+key).css("font-weight");
            //	tmp["header"] = header;
            } else if ( $("#"+key).attr("data-type") == "icon" ) {
                if (varname == key) {
                    //var unit_text = $("#elem_unit_text").val();
                    //unit_text = unit_text.trim();
                    //var dtoken = JSON.parse(unit_text);
                    tmp["on"] = $("#onvalue").val();
                    tmp["on_condition"] = $("#onexpression").val();
                    tmp["off"] = $("#offvalue").val();
                    tmp["off_condition"] = $("#offexpression").val();
                    tmp["icon"] = $("#"+key).attr("data-icon");
                    tmp["rotate"] = "rotate(" + $("#rotate").val() + "deg)";

                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    }
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    }
                } else {
                    tmp["rotate"] = $("#"+key).children().css("transform");
                    tmp["icon"] = $("#"+key).attr("data-icon");
                    tmp["on"] = $("#"+key).attr("data-on");
                    tmp["on_condition"] = $("#"+key).attr("data-onexpression");
                    tmp["off"] = $("#"+key).attr("data-off");
                    tmp["off_condition"] = $("#"+key).attr("data-offexpression");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
                    tmp["background_color"] = $("#"+key).css("background-color");
                }
		/*
            } else if ( $("#"+key).attr("data-type") == "commbit" ) {
                if (varname == key) {
                    var unit_text = $("#elem_unit_text").val();
                    unit_text = unit_text.trim();
                    var dtoken = JSON.parse(unit_text);
                    tmp["on"] = dtoken["on"];
                    tmp["off"] = dtoken["off"];
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                } else {
                    tmp["on"] = $("#"+key).attr("data-on");
                    tmp["off"] = $("#"+key).attr("data-off");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                }
            } else if ( $("#"+key).attr("data-type") == "alarm" ) {
                if (varname == key) {
                    var unit_text = $("#elem_unit_text").val();
                    unit_text = unit_text.trim();
                    var dtoken = JSON.parse(unit_text);
                    tmp["on"] = dtoken["on"];
                    tmp["off"] = dtoken["off"];
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                } else {
                    tmp["on"] = $("#"+key).attr("data-on");
                    tmp["off"] = $("#"+key).attr("data-off");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                }*/
            } else if ( $("#"+key).attr("data-type") == "integer-to-string" ) {
                if (varname == key) {
                    var unit_text = $("#elem_unit_text").val();
                    unit_text = unit_text.trim();
                    var data_condition = $("#elem_condition_range").val();
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    }
                    if ($('#elem_linkhtml').is(":checked")) {
                        tmp["linkhtml"] = "true";
                        $("#"+key).attr("data-linkhtml", "true");
                    } else {
                        tmp["linkhtml"] = "false";
                        $("#"+key).attr("data-linkhtml","false");
                    }
                    if ($('#elem_trend').is(":checked")) {
                        tmp["trend"] = "true";
                        $("#"+key).attr("data-trend", "true");
                    } else {
                        tmp["trend"] = "false";
                        $("#"+key).attr("data-trend","false");
                    }
            	    tmp["cond"] = data_condition;
            	    tmp["dict"] = unit_text;
             	    
            	    header = {};
            	    header["title"] = $("#elem_title_text").val().trim();
            	    header["size"] = $("#elem_title_size").val();
            	    header["weight"] = $("#elem_title_style option:selected").val();
            
            	    unit = {};
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $("#elem_unit_size").val();
            	    unit["weight"] = $("#elem_unit_style option:selected").val();
                } else {
            	    tmp["dict"] = $("#"+key).attr("data-dict");
            	    tmp["cond"] = $("#"+key).attr("data-cond");
            	    tmp["background_color"] = $("#"+key).css("background-color");
                    tmp["linkhtml"] = $("#"+key).attr("data-linkhtml");
                    tmp["trend"] = $("#"+key).attr("data-trend");
                    header = {};
            	    header["title"] = $(".title", "#"+key).text();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = $(".title", "#"+key).css("font-size");
            	    header["weight"] = $(".title", "#"+key).css("font-weight");
            
            	    unit = {};
            	    //unit["title"] = $(".unit_title", "#"+key).text();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $(".varval", "#"+key).css("font-size");
            	    unit["weight"] = $(".varval", "#"+key).css("font-weight");
                }
            	tmp["header"] = header;
            	tmp["unit"] = unit;
            }
            position[key] = tmp;
        }
        }
    });
    
    $('[id^=header_]').each(function( index ) {
        tmp = {};
        var hkey = $( this ).attr('id');
        console.log(hkey);
        tmp["left"] = $("#"+hkey).css("left");
        tmp["top"] = $("#"+hkey).css("top");
        tmp["width"] = $("#"+hkey).width();
        tmp["height"] = $("#"+hkey).height();
        tmp["type"] = $("#"+hkey).attr("data-type");
        header = {};
        if (token == hkey) {
            header["title"] = $("#elem_title_text").val().trim();
            //header["color"] = $(".title", "#"+key).css("color");
            header["size"] = $("#elem_title_size").val();
            header["weight"] = $("#elem_title_style option:selected").val();
            if ($('#titlelink').val().length > 0) {
                tmp["titlelink"] = $('#titlelink').val();
            }
            if ($('#background_color').val().length > 0) {
                tmp["background_color"] = $('#background_color').val();
            } else {
                tmp["background_color"] = '#0000';
            }
            // update field
            $(".title", "#"+hkey).css("font-size", header["size"] + "px");
            $(".title", "#"+hkey).css("font-weight", header["weight"]);
            
        } else {
            header["title"] = $(".title", "#"+hkey).text();
            //header["color"] = $(".title", "#"+hkey).css("color");
            header["size"] = parseInt($(".title", "#"+hkey).css("font-size")) || 28;
            header["weight"] = parseInt($(".title", "#"+hkey).css("font-weight")) || 28;
            tmp["background_color"] = $("#"+hkey).css("background-color");
            tmp["titlelink"] = $("#"+hkey).attr("data-titlelink");
	    var fontWeight = $(".title", "#"+hkey).css("font-weight");
	    if (fontWeight == 'bold' || fontWeight == '700') {
		header["weight"] = "700";
	    } else {
		header["weight"] = "400";
	    }
        }
        tmp["header"] = header;
        position[hkey] = tmp;
        tmp["type"] = "header";
        //console.log( index + ": " + $( this ).text() );
    });
    
    $('[id^=calc_]').each(function( index ) {
      var tmp = {};
        var key = this.id;
        if($("#" + key).length > 0 ) {
            tmp["ref"] = "";
            tmp["left"] = $("#"+key).css("left");
            tmp["top"] = $("#"+key).css("top");
            tmp["width"] = $("#"+key).width();
            tmp["height"] = $("#"+key).height();
            tmp["type"] = $("#"+key).attr("data-type");
            //if ( $("#"+key).attr("data-type") == "calc" ) {
                if (varname == key) {
            	    tmp["condition"] = $("#elem_condtion_range").val();
            	    tmp["formula"] = $("#elem_formula").val();
             	    tmp["lesser"] = $("#elem_lesser_range").val();
            	    tmp["larger"] = $("#elem_larger_range").val();
                    tmp["decimal"] = $("#decimal_place").val();
            
            	    header = {};
            	    header["title"] = $("#elem_title_text").val().trim();
            	    //header["color"] = $(".title", "#"+key).css("color");
            	    header["size"] = $("#elem_title_size").val();
            	    header["weight"] = $("#elem_title_style option:selected").val();
                    
                    if ($('#background_color').val().length > 0) {
                        tmp["background_color"] = $('#background_color').val();
                    } else {
                        tmp["background_color"] = '#0000';
                    }
 
            	    unit = {};
            	    unit["title"] = $("#elem_unit_text").val().trim();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
            	    unit["size"] = $("#elem_unit_size").val();
            	    unit["weight"] = $("#elem_unit_style option:selected").val();
                    
                } else {
            	    tmp["condition"] = $("#"+key).attr("data-cond");
            	    tmp["formula"] = $("#"+key).attr("data-formula");
             	    tmp["lesser"] = $("#"+key).attr("data-lesser");
            	    tmp["larger"] = $("#"+key).attr("data-larger");
		    tmp["decimal"] = $("#"+key).attr("data-decimal") || 2;
             	    //tmp["min"] = $("#"+key).attr("min");
           	        //tmp["max"] = $("#"+key).attr("max");
                    tmp["background_color"] = $("#"+key).css("background-color"); 
            	    header = {};
            	    header["title"] = $(".title", "#"+key).text();
            	    //header["color"] = $(".title", "#"+key).css("color");
                    header["size"] = parseInt($(".title", "#"+key).css("font-size")) || 28;
            	    header["weight"] = $(".title", "#"+key).css("font-weight");
            
            	    unit = {};
            	    unit["title"] = $(".unit_title", "#"+key).text();
            	    //unit["color"] = $(".varval", "#"+key).css("color");
                    unit["size"] = parseInt($(".varval", "#"+key).css("font-size")) || 28;
            	    unit["weight"] = $(".varval", "#"+key).css("font-weight");
                }
            	tmp["header"] = header;
            	tmp["unit"] = unit;
            	tmp["type"] = "calc";
            //}
            position[key] = tmp;
        }
    });
    
    $('*[data-type="rtsp"]').each(function( index ) {
        tmp = {};
        var key = $( this ).attr('id');
        console.log(key, index);
        tmp["left"] = $("#"+key).css("left");
        tmp["top"] = $("#"+key).css("top");
        tmp["width"] = Math.round($("#"+key).width());
        tmp["height"] = Math.round($("#"+key).height());
        tmp["type"] = $("#"+key).attr("data-type");
        position[key] = tmp;
    });
    
    $('*[data-type="rest"]').each(function( index ) {
        tmp = {};
        var key = $( this ).attr('id');
        console.log(key, index);
        tmp["left"] = $("#"+key).css("left");
        tmp["top"] = $("#"+key).css("top");
        tmp["type"] = $("#"+key).attr("data-type");
        tmp["width"] = Math.round($("#"+key).width());
        tmp["height"] = Math.round($("#"+key).height());
        tmp["background-color"] = $("#"+key).css("background-color");
        
        header = {};
        header["size"] = $("#"+key+ " > p >span").css("font-size");
        header["weight"] = $("#"+key + " > p > span").css("font-weight");
        header["title"] = $("#"+key + " > p > span").text();
        
        input = {};
        input["size"] = $("#"+key + " > p > input").css("font-size");
        input["weight"] = $("#"+key + " > p > input").css("font-weight");
        //input["width"] = $("#"+key + " > p > input").css("width");
        
        tmp["header"] = header;
        tmp["input"] = input;
        position[key] = tmp;
    });
    
    console.log("Check here");
    //console.log(position);
    var dataToSend = JSON.stringify(position);
    console.log(dataToSend);
    $.ajax({
        url: '/save/',
        type: 'POST',
        data: dataToSend,
        success: function (response) {
            //var objresponse = JSON.parse(response);
            alert("Save success!");
            console.log(response);
            location.reload();
        },
        error: function () {
            console.log("Error.")
        }
    });

}
    
function highlight(mydata) {
    console.log("highlight");
    console.log(varname);
    
    // switching to current control panel
    console.log($("#varname option:selected").text());
    console.log($("#varname2 option:selected").text());
    console.log($("#varname3 option:selected").text());
    
    
    var varname;
    if (control_panel == 2) {
        varname = $("#varname3 option:selected").text();
    } else if (control_panel == 1) {
        varname = $("#varname2 option:selected").text();
    } else {
        varname = $("#varname option:selected").text();
    }
    var vartype = $("#vartype option:selected").val();
    
    console.log(varname, vartype);
    
    
    $("#varname option").each(function()
    {
        $("#"+ $(this).val()).removeClass("box_highlight");
    });
    $("#varname2 option").each(function()
    {
        $("#"+ $(this).val()).removeClass("box_highlight");
    });
    $("#varname3 option").each(function()
    {
        $("#"+ $(this).val()).removeClass("box_highlight");
    });
    
    if (control_panel == 0) {
        console.log("CP=0");
        //varname = $("#varname option:selected").text();
        vartype = $("#"+varname).attr("data-type");
        
        $("#"+varname).addClass("box_highlight");
        
        icon = $("#"+varname).attr("data-icon");
        if (typeof vartype == "undefined") {
            $("#vartype").val("data");
        } else {
            $("#vartype").val(vartype);
        }
        console.log(varname, vartype,icon);
        // clear values
        $("#elem_title_text").val("");
        $("#elem_title_size").val("");
        $("#elem_unit_text").val("");
        $("#elem_unit_size").val("");
        $("#elem_lesser_range").val("");
        $("#elem_larger_range").val("");
        $("#elem_condition_range").val("");
        $("#elem_formula").val("");
        $("#decimal_place").val("");
        $("#titlelink").val("");
        $("#varattr").val("normal");
        $("#virtual_id_text").val("");
        $("#background_color").val("");
        $('#elem_exponential').prop('checked', false);
        $('#elem_linkhtml').prop('checked', false);
        $('#elem_trend').prop('checked', false);
        $('#elem_unit_text').removeClass('glowing_border');
        $('#elem_title_text').removeClass('glowing_border');
        $('#elem_formula').removeClass('glowing_border');
        $("#icon").val("");
        $('#icon').prop('disabled', true);
        $('#onexpression').prop('disabled', true);
        $('#onvalue').prop('disabled', true);
        $('#offexpression').prop('disabled', true);
        $('#offvalue').prop('disabled', true);
        $('#onexpression').val("");
        $('#onvalue').val("");
        $('#offexpression').val('disabled', true);
        $('#offvalue').val("");
        $("#rotate").val("");
     
        if (vartype == "header") {
            $("#elem_title_text").val($("#"+varname + " .title").text());
            $("#elem_title_size").val(parseInt($("#"+varname + " .title").css("font-size")));
            $("#titlelink").val($("#"+varname).attr("data-titlelink"));
     
            $("#elem_title_style").val("400");
            var fontWeight = $("#"+varname + " .title").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_title_style").val("700");
            }
            
            $("#elem_unit_style").val("400");
            var fontWeight = $("#"+varname + " .varval").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_unit_style").val("700");
            }
            
            $("#background_color").val("");
            if ($("#"+varname).css("background-color") ) {
                $("#background_color").val($("#"+varname).css("background-color"));
            }
      

        } else if (vartype == "data") {
            
            if (($("#"+varname).attr("data-exponential")) == "true" || ($("#"+varname).attr("data-exponential")) == "true") {
                $('#elem_exponential').prop('checked', true);
            } else {
                $('#elem_exponential').prop('checked', false);
            }
            if (($("#"+varname).attr("data-linkhtml")) == "true" || ($("#"+varname).attr("data-linkhtml")) == "true") {
                $('#elem_linkhtml').prop('checked', true);
            } else {
                $('#elem_linkhtml').prop('checked', false);
            }
            if (($("#"+varname).attr("data-trend")) == "true" || ($("#"+varname).attr("data-trend")) == "true") {
                $('#elem_trend').prop('checked', true);
            } else {
                $('#elem_trend').prop('checked', false);
            }
            $("#elem_title_text").val($("#"+varname + " .title").text().trim());
            $("#elem_title_size").val("");
            if ($("#"+varname + " .title").css("font-size")) {
                $("#elem_title_size").val(parseFloat($("#"+varname + " .title").css("font-size")));
            }
            $("#elem_unit_text").val($("#"+varname + " .unit_title").text().trim());
            $("#elem_unit_size").val("");
            if ($("#"+varname + " .varval").css("font-size")) {
                $("#elem_unit_size").val(parseFloat($("#"+varname + " .varval").css("font-size")));
            }
            $("#elem_lesser_range").val("");
            if ($("#"+varname).attr("data-lesser") ) {
                $("#elem_lesser_range").val($("#"+varname).attr("data-lesser"));
            }
            $("#elem_larger_range").val("");
            if ($("#"+varname).attr("data-larger") ) {
                $("#elem_larger_range").val($("#"+varname).attr("data-larger"));
            }
        $("#decimal_place").val("");
        if ($("#"+varname).attr("data-decimal") ) {
                $("#decimal_place").val($("#"+varname).attr("data-decimal"));
        }
            $("#background_color").val("");
            if ($("#"+varname).css("background-color") ) {
                $("#background_color").val($("#"+varname).css("background-color"));
            }
            $("#elem_condition_range").val("");
            if ($("#"+varname).attr("data-cond") ) {
                $("#elem_condition_range").val($("#"+varname).attr("data-cond"));
            }
            $("#elem_formula").val("");
            if ($("#"+varname).attr("data-formula") ) {
                $("#elem_formula").val($("#"+varname).attr("data-formula"));
            }
            
            $("#elem_title_style").val("400");
            var fontWeight = $("#"+varname + " .title").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_title_style").val("700");
            }
            
            $("#elem_unit_style").val("400");
            var fontWeight = $("#"+varname + " .varval").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_unit_style").val("700");
            }
      
            if (varname.includes("virtual")){
                $("#varattr").val("virtual");
            } else {
                $("#varattr").val("normal");
            }


        } else if (vartype == "calc") {
            var vid = varname.split("_");
            vid = vid[1];
            $("#virtual_id_text").val(vid);
            
            
            $("#elem_title_text").val($("#"+varname + " .title").text().trim());
            $("#elem_title_size").val("");
            if ($("#"+varname + " .title").css("font-size")) {
                $("#elem_title_size").val(parseFloat($("#"+varname + " .title").css("font-size")));
            }
            $("#elem_unit_text").val($("#"+varname + " .unit_title").text().trim());
            $("#elem_unit_size").val("");
            if ($("#"+varname + " .varval").css("font-size")) {
                $("#elem_unit_size").val(parseFloat($("#"+varname + " .varval").css("font-size")));
            }
            $("#elem_lesser_range").val("");
            if ($("#"+varname).attr("data-lesser") ) {
                $("#elem_lesser_range").val($("#"+varname).attr("data-lesser"));
            }
            $("#elem_larger_range").val("");
            if ($("#"+varname).attr("data-larger") ) {
                $("#elem_larger_range").val($("#"+varname).attr("data-larger"));
            }
            $("#elem_condition_range").val("");
            if ($("#"+varname).attr("data-cond") ) {
                $("#elem_condition_range").val($("#"+varname).attr("data-cond"));
            }
            $("#elem_formula").val("");
            if ($("#"+varname).attr("data-formula") ) {
                $("#elem_formula").val($("#"+varname).attr("data-formula"));
            }
            $("#decimal_place").val("");
            if ($("#"+varname).attr("data-decimal") ) {
                $("#decimal_place").val($("#"+varname).attr("data-decimal"));
            }
            $("#background_color").val("");
            if ($("#"+varname).css("background-color") ) {
                $("#background_color").val($("#"+varname).css("background-color"));
            }
            $("#elem_title_style").val("400");
            var fontWeight = $("#"+varname + " .title").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_title_style").val("700");
            }

            $("#elem_unit_style").val("400");
            var fontWeight = $("#"+varname + " .varval").css("font-weight");
            if (fontWeight == 'bold' || fontWeight == '700') {
                $("#elem_unit_style").val("700");
            }


         } else if (vartype == "icon") {
            $("#icon").val(icon);
            $('#icon').prop('disabled', false);
            $('#onexpression').prop('disabled', false);
            $('#onvalue').prop('disabled', false);
            $('#offexpression').prop('disabled', false);
            $('#offvalue').prop('disabled', false);
            $('#onvalue').val($("#"+varname).attr("data-on"));
            $('#onexpression').val($("#"+varname).attr("data-onexpression"))
            $('#offvalue').val($("#"+varname).attr("data-off"));
            $('#offexpression').val($("#"+varname).attr("data-offexpression"))

            var matrix = $("#"+varname).children().css("transform");
            if(matrix !== 'none') {
                var values = matrix.split('(')[1].split(')')[0].split(',');
                var a = values[0];
                var b = values[1];
                var angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
            } else {
                var angle = 0;
            }

            $("#rotate").val(angle);

            //$("#elem_unit_text").val('{"on":'+$("#"+varname).attr("data-on") + ',"off":'+$("#"+varname).attr("data-off")+'}' );

            if (($("#"+varname).attr("data-linkhtml")) == "true" || ($("#"+varname).attr("data-linkhtml")) == "true") {
                $('#elem_linkhtml').prop('checked', true);
            } else {
                $('#elem_linkhtml').prop('checked', false);
            }
            if (($("#"+varname).attr("data-trend")) == "true" || ($("#"+varname).attr("data-trend")) == "true") {
                $('#elem_trend').prop('checked', true);
            } else {
                $('#elem_trend').prop('checked', false);
            }
            $("#background_color").val("");
            if ($("#"+varname).css("background-color") ) {
                $("#background_color").val($("#"+varname).css("background-color"));
            }
            if (varname.includes("virtual")){
                $("#varattr").val("virtual");
            } else {
                $("#varattr").val("normal");
            }
        /*
        } else if (vartype == "commbit") {
            $("#elem_unit_text").val('{"on":'+$("#"+varname).attr("data-on") + ',"off":'+$("#"+varname).attr("data-off")+'}' );
            if (($("#"+varname).attr("data-linkhtml")) == "true" || ($("#"+varname).attr("data-linkhtml")) == "true") {
                $('#elem_linkhtml').prop('checked', true);
            } else {
                $('#elem_linkhtml').prop('checked', false);
            }
        } else if (vartype == "alarm") {
            $("#elem_unit_text").val('{"on":'+$("#"+varname).attr("data-on") + ',"off":'+$("#"+varname).attr("data-off")+'}' );
            if (($("#"+varname).attr("data-linkhtml")) == "true" || ($("#"+varname).attr("data-linkhtml")) == "true") {
                $('#elem_linkhtml').prop('checked', true);
            } else {
                $('#elem_linkhtml').prop('checked', false);
            }*/
        } else if (vartype == "integer-to-string") {
            $("#elem_title_text").val($("#"+varname + " .title").text().trim());
            $("#elem_title_size").val("");
            if ($("#"+varname + " .title").css("font-size")) {
                $("#elem_title_size").val(parseFloat($("#"+varname + " .title").css("font-size")));
            }
            $("#elem_unit_text").val($("#"+varname).attr("data-dict"));
            $("#elem_condition_range").val("");
            if ($("#"+varname).attr("data-cond") ) {
                $("#elem_condition_range").val($("#"+varname).attr("data-cond"));
            }
            $("#background_color").val("");
            if ($("#"+varname).css("background-color") ) {
                $("#background_color").val($("#"+varname).css("background-color"));
            }
            if (($("#"+varname).attr("data-linkhtml")) == "true" || ($("#"+varname).attr("data-linkhtml")) == "true") {
                $('#elem_linkhtml').prop('checked', true);
            } else {
                $('#elem_linkhtml').prop('checked', false);
            }
            if (($("#"+varname).attr("data-trend")) == "true" || ($("#"+varname).attr("data-trend")) == "true") {
                $('#elem_trend').prop('checked', true);
            } else {
                $('#elem_trend').prop('checked', false);
            }
        }
        
        
    } else if (control_panel == 1) {
        console.log("CP=1");
        $('*[data-type="rest"]').each(function( index ) {
            var key = $( this ).attr('id');
            console.log($( this ).width());
            if(($("#" + key).length > 0) && (varname.match(key))) {
                //$("#"+key).addClass("box_highlight");
                console.log("on", key, varname);
                $("#"+varname).addClass("box_highlight");
                $("#rtsp_width").val( Math.round($( this ).width()) );
                $("#rtsp_height").val( Math.round($( this ).height()) );
            } else {
                //console.log("off");
                $("div").not(document.getElementById(varname)).removeClass("box_highlight");
            }
        });
        
        
    } else { // control_panel = 2
        console.log("CP=2");
        
        $('*[data-type="rtsp"]').each(function( index ) {
            var key = $( this ).attr('id');
            console.log($( this ).width());
            if(($("#" + key).length > 0) && (varname.match(key))) {
                //$("#"+key).addClass("box_highlight");
                console.log("on", key, varname);
                $("#"+varname).addClass("box_highlight");
                $("#rtsp_width").val( Math.round($( this ).width()) );
                $("#rtsp_height").val( Math.round($( this ).height()) );
            } else {
                //console.log("off");
                $("div").not(document.getElementById(varname)).removeClass("box_highlight");
            }
        });
        
    }
}

/*
var controls = new function() {
    this.rotationSpeed = 0.02;
    this.bouncingSpeed = 0.03;
}
    
var gui = new dat.GUI();
    
groupADEI = gui.addFolder("ADEI");
    
groupADEI.add(controls, 'rotationSpeed', 0, 0.5);
groupADEI.add(controls, 'bouncingSpeed', 0, 0.5);
*/
 
 
/*
// Define your config object
const CONFIG = {
  Sensor: ,
  B: {
    C: {
      D: 34,
      E: 48,
      F: 99
    }
  },
  G: {
    H: {
      I: {
        J: 87
      }
    }
  }
};
// Mirror that object in a BOUNDS config
// This mirrors config but the values are the arguments
// for each configurable value
const BOUNDS = {
  A: [0, 100, 1],
  B: {
    C: {
      D: [0, 100, 1],
      E: [0, 100, 1],
      F: [0, 100, 1]
    }
  },
  G: {
    H: {
      I: {
        J: [0, 100, 1]
      }
    }
  }
};

const GUI = new dat.GUI();

console.info(dat.GUI, GUI);

const digest = (CONFIG_OBJECT, BOUNDS_OBJECT, FOLDER) => {
  for (const category in BOUNDS_OBJECT) {
    if (Array.isArray(BOUNDS_OBJECT[category])) {
      FOLDER.add(
        CONFIG_OBJECT,
        category,
        BOUNDS_OBJECT[category][0],
        BOUNDS_OBJECT[category][1],
        BOUNDS_OBJECT[category][2] ? BOUNDS_OBJECT[category][2] : 1
      ).onChange(console.info);
    } else {
      const NEW_FOLDER = FOLDER
        ? FOLDER.addFolder(category)
        : GUI.addFolder(category);
      digest(CONFIG_OBJECT[category], BOUNDS_OBJECT[category], NEW_FOLDER);
    }
  }
};
digest(CONFIG, BOUNDS, GUI);
*/

var obj = {
    select:function(){ console.log("select") },
    update:function(){ console.log("update") },
    add:function(){ console.log("add") },
    remove:function(){ console.log("remove") },
    save:function(){ console.log("save") },
    backup:function(){ console.log("backup") }
};



var default_values =
{
    name: ""
}
    
/********
 Prepare the list beforehand
 **/



gui = new dat.GUI();
var mygroup;
var folder;

var params = {}
var tmp_color;

{% for category in data["typedef"] %}
    
    folder = gui.addFolder("{{ category }}");
    
    // Other params here
    
    {% for datatype in data["typedef"][category] %}
        
        subfolder = folder.addFolder("{{ datatype }}");
        
        mygroup = {};
        {% for item in data["vardata"][ category ] %}
        if ('{{ data["vardata"][ category ][item]["type"] }}' == '{{ datatype }}') {
            mygroup["{{ item }}"] = "{{ item }}";
        }
        {% end %}
        subfolder.add(default_values, "name", mygroup );
        subfolder.add(obj, 'select');

        {% for item in data["typedef"][ category ][ datatype] %}
            console.log("{{ item }}", '{{ data["typedef"][ category ][ datatype][item]["value"] }}', '{{ data["typedef"][ category ][ datatype][item]["type"] }}' );
            
            if ('{{ data["typedef"][ category ][ datatype][item]["type"] }}' == "string") {
                params['{{ item }}'] = '{{ data["typedef"][ category ][ datatype][item]["value"] }}';
            } else if ('{{ data["typedef"][ category ][ datatype][item]["type"] }}' == "bool") {
                if ('{{ data["typedef"][ category ][ datatype][item]["value"] }}' == "True") {
                    params['{{ item }}'] = true;
                } else {
                    params['{{ item }}'] = false;
                }
            } else if ('{{ data["typedef"][ category ][ datatype][item]["type"] }}' == "color") {
                
                params['{{ item }}'] = '{{ data["typedef"][ category ][ datatype][item]["value"] }}';
            } else {
                params['{{ item }}'] = '{{ data["typedef"][ category ][ datatype][item]["value"] }}';
            }
            subfolder.add(params, '{{ item }}');
        {% end %}
    {% end %}
    
    
    folder.add(obj, 'update');
    folder.add(obj, 'add');
    folder.add(obj, 'remove');
    folder.add(obj, 'save');
    folder.add(obj, 'backup');
{% end %}

//GUI.addFolder(category);
    


//gui.add(default_values, "name", adei );


jQuery(window).load(function () {
    
    $("#varname > option").each(function() {
        if ($('#'+this.text).length){
            $('#'+this.text).draggable();
            $('#'+this.text).resizable(); 
            $('#'+this.text).click(function() {
                //console.log($(this).attr("id")); 
                $("#varname").val($(this).attr("id"));
                $("#buttonHighlight").trigger("click"); 
            });
        }
        //console.log(this.text + ' ' + this.value);
    });
    
    $("#varname2 > option").each(function() {
        if ($('#'+this.text).length){
            $('#'+this.text).draggable();
            $('#'+this.text).resizable();
            $('#'+this.text).click(function() {
                //console.log($(this).attr("id"));
                $("#varname2").val($(this).attr("id"));
                $("#buttonHighlight").trigger("click");
            });
        }
        //console.log(this.text + ' ' + this.value);
    });
    
    $("#varname3 > option").each(function() {
        if ($('#'+this.text).length){
            $('#'+this.text).draggable();
            $('#'+this.text).resizable();
            $('#'+this.text).click(function() {
                //console.log($(this).attr("id"));
                $("#varname3").val($(this).attr("id"));
                $("#buttonHighlight").trigger("click");
            });
        }
        //console.log(this.text + ' ' + this.value);
    });
    
    $("#buttonHighlight").trigger("click"); 
    $("#varname").change(function() {
        varval = $( "#varname option:selected").val();
        varname = $("#varname option:selected").text();
        //console.log(varval, varname);
        $("#buttonHighlight").trigger("click"); 
    });
    
    $("#varname2").change(function() {
        varval = $( "#varname2 option:selected").val();
        varname = $("#varname2 option:selected").text();
        //console.log(varval, varname);
        $("#buttonHighlight").trigger("click");
    });
    
    $("#varname3").change(function() {
        varval = $( "#varname3 option:selected").val();
        varname = $("#varname3 option:selected").text();
        //console.log(varval, varname);
        $("#buttonHighlight").trigger("click");
    });
    
    $("#vartype").change(function() {
        vartype = $("#vartype option:selected").val();
        if ((vartype == "header") || (vartype == "calc")) {
            $("#varname").val("");
            // clear values
	        $("#elem_title_text").val("");
	        $("#elem_title_size").val("");
	        $("#elem_unit_text").val("");
	        $("#elem_unit_size").val("");
	        $("#elem_lesser_range").val("");
	        $("#elem_larger_range").val("");
	        $("#elem_condition_range").val("");
	        $("#elem_formula").val("");
            $("#background_color").val("");
        }       
    });
});
</script>


</body>
</html>
