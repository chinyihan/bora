<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>{{ data['title'] }} Status display</title>
  <meta name="description" 
          content="Status display generated by BORA.">
  <link rel="stylesheet" href="{{ static_url("style.css") }}">
  <link rel="stylesheet" href="{{ static_url("jquery-ui.min.css") }}">
  <!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>


<div id="page_info">
    <button id="btn_page1" style="display:inline;">Main</button>
    <button id="btn_page2" style="display:none;">Notebook</button>
    <button id="btn_page3" style="display:none;">Config</button>
    <span>[VER {{ data['version'] }}] {{ data['title'] }} data monitoring.</span>
    Last refreshed: <span class="time_info"></span></div>
<div id="page_title_cache" style="display:none;">{{ data['title'] }}</div>
<div id="page_version_cache" style="display:none;">{{ data['version'] }}</div>


<div id="page1">
<img src="{{ static_url( 'background.png' ) }}"></img>
    <div id="horizontal" class="horizontal" style="display: none;"></div>
    <div id="vertical" class="vertical" style="display:none;"></div>

{% if data['style'] %}
{% for key in data['style'] %}
<!-- BORA START -->


<!-- BORA END -->
{% end %}
{% end %}


</div>

<div id="page2" style="display:none;">
    <!--<iframe width="890" height="700" src="https://live.easygenerator.com" frameborder="0" allowfullscreen></iframe>-->
<iframe width="890" height="700" src="http://ipepdvcompute1.ipe.kit.edu:8000" frameborder="0" allowfullscreen></iframe>

 
    <!--<iframe width="100%" height="100%" frameborder="0" src="http://ipepdvcompute1.ipe.kit.edu:8000"></iframe>-->
</div>

<div id="page3" style="display:none;">
<textarea id="config_input" rows="40" cols="100" style="margin-top: 40px;">
</textarea>
<button id="config_save">Save</button>
</div>

<!-- java script -->
<script src="{{ static_url("jquery-1.12.3.min.js") }}"></script>
<script src="{{ static_url("jquery-ui.min.js") }}"></script>
<script src="{{ static_url("math.min.js") }}"></script>
<script src="{{ static_url("dat.gui.js") }}"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/rtsp-relay@1.7.0/browser/index.js"></script>-->
<!-- BORA-JS -->


<!-- BORA-JS -->
<script>
// Function to be executed on button click
function handleClickPage1() {
    $("#page1").show();
    $("#page2").hide();
    $("#page3").hide();
    $("#btn_page1").css("color", "black");
    $("#btn_page2").css("color", "#e0e0e0");
    $("#btn_page3").css("color", "#e0e0e0");
}
function handleClickPage2() {
    $("#page2").show();
    $("#page1").hide();
    $("#page3").hide();
    $("#btn_page2").css("color", "black");
    $("#btn_page1").css("color", "#e0e0e0");
    $("#btn_page3").css("color", "#e0e0e0");
}
function handleClickPage3() {
    $("#page3").show();
    $("#page2").hide();
    $("#page1").hide();
    $("#btn_page3").css("color", "black");
    $("#btn_page2").css("color", "#e0e0e0");
    $("#btn_page1").css("color", "#e0e0e0");
}

// Get the button element by its ID
const button1 = document.getElementById("btn_page1");
const button2 = document.getElementById("btn_page2");
const button3 = document.getElementById("btn_page3");
const button_config = document.getElementById("config_save");

// Add a click event listener to the button
button1.addEventListener("click", handleClickPage1);
button2.addEventListener("click", handleClickPage2);
button3.addEventListener("click", handleClickPage3);
button_config.addEventListener("click", handleClickConfig);

$("#btn_page1").css("color", "black");
$("#btn_page2").css("color", "#e0e0e0");
$("#btn_page3").css("color", "#e0e0e0");

var gui = new dat.GUI();
var obj = {
    notebook: function(){ $("#btn_page2").toggle() },
    settings: function(){ $("#btn_page3").toggle() },
    designer: function(){ 
        window.open( window.location.origin + "/designer", "_blank"); 
    }
};
var folder1 = gui.addFolder('Navigate to Page');
folder1.add(obj, 'designer');
var folder2 = gui.addFolder('Activate/Deactivate Tab');
folder2.add(obj, 'notebook');
folder2.add(obj, 'settings');
gui.hide();

// function to handle success
function config_success() {
    var data = JSON.parse(this.responseText); //parse the string to JSON
    console.log(data);
}

function config_error(err) {
    console.log('Request Failed', err); //error details will be in the "err" object
}

function handleClickConfig() {
    var url = "http://localhost:5617/config";

    //var data = {};
    //data.value = value;
    //var json = JSON.stringify(data);

    var data = document.getElementById('config_input').value;
    var json = JSON.stringify(data);
    //var json = JSON.parse(input);

    var xhr = new XMLHttpRequest();
    xhr.onload = config_success;
    xhr.onerror = config_error;
    xhr.open('PUT', url);
    xhr.send(json);
}

setInterval(function() {
    $.ajax({
        url: '/getdata/',
        type: 'GET',
        success: function (response) {
            //console.log(response);
            let currentTime = new Date();
            let currentTimeMillis = currentTime.getTime();
            let currentUTCTime = currentTime.toUTCString();

            //console.log("Current time in milliseconds: " + currentTimeMillis);
            
            $("#page_info > .time_info").text("Time in UTC: " + currentUTCTime);
            
            for (var key in response) {
                var retval = eval( "parse_" + response[key]["interface"] + "('" + key + "','" + response[key]['value'] + "')" );
                $("#" + key + " > .value").text(retval);
            }
        },
        error: function () {

        }
    });
}, {{ data["delay"] }}); // update about every second



</script>
</body>
</html>
